<?xml version="1.0" encoding="UTF-8"?>
<!--
  note-format.xml - 笔记编写规范
  
  结构设计：按层次组织
  - 核心目标 → 格式规则（基础）→ 逻辑规则（结构）→ 内容规则（处理）→ 常见问题（改进）
  
  版本：4.0 (2026-01-08)
-->

<NoteFormatSpec>

  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                           核心目标                                        ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <CoreGoal>
    <Mission>不是记录，而是重组知识的逻辑结构</Mission>
    <CoreRequirement>消除并列，显化逻辑关系</CoreRequirement>
    <Principle>格式服务于逻辑，不是为了美观</Principle>
    <SuccessCriteria>
      <criterion>所有缩进行都有列表标记（- 或 1.）</criterion>
      <criterion>无并列列举（或已说明逻辑关系）</criterion>
      <criterion>核心概念已加粗</criterion>
      <criterion>无来源标注（融合为统一知识点）</criterion>
    </SuccessCriteria>
  </CoreGoal>

  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第一层：格式规则（基础）                                  ║
       ║  目的：确保笔记在Obsidian中正确渲染                                         ║
       ║  关系：这是后续逻辑规则和内容规则的基础                                       ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <FormatRules>
    <Purpose>确保笔记在Obsidian中正确渲染</Purpose>
    
    <Rule id="FR-1" name="列表标记">
      <correct>Tab + - + 内容</correct>
      <correct>Tab + 1. + 内容</correct>
      <wrong>Tab + 内容（禁止只用Tab不加列表标记）</wrong>
      <guidance>
        <when_ordered>有时序/步骤关系 → 使用 1. 2. 3.</when_ordered>
        <when_unordered>非时序关系 → 使用 -</when_unordered>
      </guidance>
    </Rule>

    <Rule id="FR-2" name="小标题">
      <allowed>###（章节/钩子问题）</allowed>
      <allowed>####（支撑知识）</allowed>
      <forbidden>##### 及更深层级</forbidden>
    </Rule>

    <Rule id="FR-3" name="分割线">
      <usage>只在钩子问题之间使用</usage>
      <format>认知过渡 → --- → 下一个钩子问题</format>
      <forbidden>在其他地方使用分割线</forbidden>
    </Rule>

    <Rule id="FR-4" name="缩进">
      <meaning>缩进 = 逻辑从属（下一级是对上一级的展开/支撑/细化）</meaning>
      <decision_guide>
        <case relation="展开/细化/支撑">缩进</case>
        <case relation="并列/同级">同级</case>
        <case relation="新话题">回到上级或新起一节</case>
      </decision_guide>
    </Rule>

    <Rule id="FR-5" name="语义化标签">
      <principle>用标签表达逻辑关系，而非元标签</principle>
      <correct>原因：、后果：、机制：、效果：、代价：</correct>
      <wrong>（因果关系）、（递进式串联）</wrong>
    </Rule>

    <Rule id="FR-6" name="其他格式">
      <forbidden reason="Obsidian表格必须顶格，无法嵌入缩进结构">表格</forbidden>
      <format name="认知过渡">> **认知过渡**：[内容]（顶格）</format>
      <format name="认知地图">放在文档开头</format>
    </Rule>
  </FormatRules>


  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第二层：逻辑规则（结构）                                  ║
       ║  目的：确保笔记有清晰的逻辑结构                                             ║
       ║  关系：基于格式规则（第一层），指导内容的组织方式                              ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <LogicRules>
    <Purpose>确保笔记有清晰的逻辑结构，而非知识点堆砌</Purpose>
    <Depends>格式规则提供渲染基础，逻辑规则指导内容组织</Depends>
    
    <Rule id="LR-1" name="遵循教案结构">
      <description>笔记的逻辑组织由教案决定，按照教案中定义的知识结构和逻辑关系组织内容</description>
    </Rule>

    <Rule id="LR-2" name="语义化标签体现逻辑关系">
      <LogicType name="因果">原因：、后果：、影响：、根源：</LogicType>
      <LogicType name="递进">第一层：、第二层： 或 1.、2.、3.</LogicType>
      <LogicType name="对比">**A特点**：、**B特点**：、**核心差异**：</LogicType>
      <LogicType name="总分">**总**：、**分**：</LogicType>
      <LogicType name="方案链条">机制：、效果：、代价：、缓解：、场景：</LogicType>
    </Rule>

    <Rule id="LR-3" name="语义化标签体现分类维度">
      <examples>**性能影响**：、**可用性**：、**适用场景**：、**可接受场景**：、**不可接受场景**：</examples>
    </Rule>
  </LogicRules>

  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第三层：内容规则（处理）                                  ║
       ║  目的：指导如何处理和组织具体内容                                           ║
       ║  关系：在格式规则和逻辑规则的基础上，处理具体内容                              ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <ContentRules>
    <Purpose>指导如何处理和组织具体内容</Purpose>
    <Depends>格式规则 + 逻辑规则 → 内容处理</Depends>

    <Rule id="CR-1" name="信息融合">
      <sources>AI教学内容 + 学生验证回答</sources>
      <principles>
        <principle>融合为一个完整知识点</principle>
        <principle>采用更合理的逻辑组织方式</principle>
        <principle>不标注来源（不标记"学生理解"或"教师讲解"）</principle>
      </principles>
    </Rule>

    <Rule id="CR-2" name="补充知识插入">
      <description>用户补充的知识需找到逻辑上正确的位置插入，不是简单追加到末尾</description>
    </Rule>

    <Rule id="CR-3" name="信息压缩">
      <when_first>完整解释</when_first>
      <when_subsequent>简要引用或压缩形式</when_subsequent>
      <example>时间解耦（消息持久化机制）而非重复完整解释</example>
    </Rule>

    <Rule id="CR-4" name="示例放置">
      <simple_example>紧跟概念，同行或子点</simple_example>
      <complex_example>单独子节，但仍靠近概念</complex_example>
    </Rule>

    <Rule id="CR-5" name="加粗使用">
      <usage>只加粗定义性核心概念</usage>
      <format>**[概念名]**：[定义]</format>
      <forbidden>过度加粗</forbidden>
    </Rule>
  </ContentRules>

  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第四层：常见问题与自检（改进）                             ║
       ║  目的：记录常见问题，提供自检清单                                           ║
       ║  关系：这是对前三层执行过程中发现问题的总结                                   ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <CommonIssuesAndChecklist>
    <Purpose>记录常见问题，提供自检清单</Purpose>
    
    <CommonIssues>
      <Issue id="CI-1" symptom="Tab + 内容" solution="改为 Tab + - + 内容" />
      <Issue id="CI-2" symptom="使用 #####" solution="改为缩进 + 加粗" />
      <Issue id="CI-3" symptom="在非钩子问题处使用分割线" solution="删除，只保留钩子问题之间的" />
      <Issue id="CI-4" symptom="随意缩进" solution="检查是否为展开/支撑/细化关系" />
      <Issue id="CI-5" symptom="简单列出1.2.3." solution="识别逻辑关系或说明分类维度" />
      <Issue id="CI-6" symptom="标记学生理解/补充讲解" solution="删除标注，融合为统一知识点" />
    </CommonIssues>

    <SelfCheck trigger="记录笔记后，输出前" phase="Post-hook">
      <check id="NF-1">□ 所有缩进行是否都有列表标记（- 或 1.）？</check>
      <check id="NF-2">□ 是否有裸露的并列列举？如有，是否说明了逻辑关系？</check>
      <check id="NF-3">□ 小标题是否只使用 ### 和 ####？</check>
      <check id="NF-4">□ 分割线是否只在钩子问题之间？</check>
      <check id="NF-5">□ 核心概念是否已加粗？</check>
      <check id="NF-6">□ 是否删除了来源标注？</check>
    </SelfCheck>
  </CommonIssuesAndChecklist>

  <!-- 参考示例 -->
  <Examples>
    <Example id="parallel-vs-logical" name="并列 vs 逻辑关系">
      <wrong><![CDATA[
三种通信模式：
1. RPC
2. 消息队列
3. 发布-订阅
（问题：无逻辑关系的并列）]]></wrong>
      <correct><![CDATA[
三种通信模式的选择本质上是权衡（递进关系：解耦程度递增）：
- RPC：牺牲解耦 → 换取立即响应
- 消息队列：牺牲立即响应 → 换取时间解耦
- 发布-订阅：进一步牺牲调试便利性 → 换取空间解耦]]></correct>
    </Example>
  </Examples>

  <!-- 更新记录 -->
  <UpdateHistory>
    <Update date="2026-01-07" version="3.0">从Markdown转换为XML格式</Update>
    <Update date="2026-01-08" version="4.0">按逻辑层次重构：格式规则→逻辑规则→内容规则→常见问题</Update>
  </UpdateHistory>

</NoteFormatSpec>
