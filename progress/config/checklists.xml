<?xml version="1.0" encoding="UTF-8"?>
<!--
  checklists.xml - 教学检查清单
  
  结构设计：按教学流程的时序组织
  - Pre-hook（教学前）→ In-process（教学中）→ Post-hook（教学后）
  
  版本：4.0 (2026-01-08)
-->

<Checklists>

  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                           核心目标                                        ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <CoreGoal>
    <Mission>确保教学和记录过程遵循所有规则，在正确的时机进行正确的检查</Mission>
    <SuccessCriteria>
      <criterion>教学内容无并列列举</criterion>
      <criterion>所有数据经过验证</criterion>
      <criterion>笔记格式符合规范</criterion>
      <criterion>验证问题避免并列答案</criterion>
    </SuccessCriteria>
    <Usage>
      <when>教学前：加载 Pre-hook 检查</when>
      <when>教学中：执行 In-process 检查</when>
      <when>教学后：执行 Post-hook 检查</when>
    </Usage>
  </CoreGoal>

  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第一阶段：Pre-hook（教学前检查）                          ║
       ║  目的：在教学开始前确保准备充分，避免教学过程中出现问题                         ║
       ║  时机：收到教学请求后，开始教学前                                            ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <PreHook phase="教学前" trigger="收到教学请求后，开始教学前">
    <Purpose>确保教学准备充分，预防问题而非事后修正</Purpose>
    
    <!-- 1. 意图确认（防止答非所问） -->
    <Check id="PRE-1" name="意图确认" priority="high">
      <why>误解意图会导致整个教学方向错误</why>
      <trigger>问题模糊/多义/超出范围时</trigger>
      <action>复述理解 → 提供选项 → 获得确认</action>
      <exception>简单明确的问题可直接回答</exception>
    </Check>
    
    <!-- 2. 知识边界声明（减少幻觉） -->
    <Check id="PRE-2" name="知识边界声明" priority="high">
      <why>主动声明边界，避免在不确定领域过度自信</why>
      <trigger>开始新内容/涉及具体数值/最新技术时</trigger>
      <format>确定知道 | 可能知道 | 不确定</format>
    </Check>
    
    <!-- 3. 数据验证（确保准确性） -->
    <Check id="PRE-3" name="数据验证" priority="high">
      <why>错误的数据会误导学生</why>
      <workflow>
        <step order="1">检查 reusable-knowledge.json → verified_data</step>
        <step order="2" if="not_found">网络搜索验证</step>
        <step order="3" if="cannot_verify">使用定性描述（如"毫秒级"而非"10ms"）</step>
      </workflow>
      <types_requiring_verification>性能数据、阈值、公式、容量限制</types_requiring_verification>
    </Check>
    
    <!-- 4. 可复用知识检查 -->
    <Check id="PRE-4" name="可复用知识" priority="medium">
      <why>避免重复介绍已学过的维度</why>
      <action>检查 reusable-knowledge.json 中已学习的维度</action>
      <handling type="reused">直接应用，不重复介绍</handling>
      <handling type="new">介绍定义、重要性、影响因素</handling>
    </Check>
    
    <!-- 5. 概念边界检查 -->
    <Check id="PRE-5" name="概念边界" priority="medium">
      <why>先定义再使用，避免专家盲点</why>
      <questions>
        <question>是否引入了未定义的新术语？</question>
        <question>每个概念是否在首次使用前定义？</question>
        <question>引用的外部概念是否在学生知识库中？</question>
      </questions>
    </Check>
  </PreHook>


  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第二阶段：In-process（教学中检查）                         ║
       ║  目的：边教边查，及时发现和修正问题                                          ║
       ║  时机：生成教学内容时                                                       ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <InProcess phase="教学中" trigger="生成教学内容时">
    <Purpose>边写边查，问题发现越早修正成本越低</Purpose>
    
    <!-- 1. 内容组织检查（最关键） -->
    <Check id="IN-1" name="内容组织" priority="critical">
      <why>并列列举无法体现知识点之间的关系</why>
      
      <MandatoryInternalCheck trigger="写任何包含2+项的内容之前">
        <step order="1">关系是什么？（时序/因果/递进/分类/层次/对比）</step>
        <step order="2">如果是分类：分类维度是什么？</step>
        <step order="3">如何按这个关系组织？</step>
      </MandatoryInternalCheck>
      
      <OutputRequirement>
        <must>使用关系驱动的结构（总-分 + 明确的关系词）</must>
        <forbidden>直接列出 "1. 2. 3." 而没有关系上下文</forbidden>
        <forbidden>使用模糊词语（按重要性、按优先级）而没有明确标准</forbidden>
      </OutputRequirement>
      
      <SelfCheck trigger="写完后">
        <question violation="true">我是否刚写了裸露的列表项？</question>
        <question required="true">关系词是否可见？</question>
        <question violation="true">我是否使用了没有标准的模糊词语？</question>
      </SelfCheck>
    </Check>
    
    <!-- 2. 内容密度检查 -->
    <Check id="IN-2" name="内容密度" priority="high">
      <why>防止形式主义，确保内容有实质</why>
      <four_elements>
        <element>是什么：定义 + 核心特征</element>
        <element>为什么：解决什么问题 + 为什么这样设计</element>
        <element>怎么用：适用场景 + 使用方式</element>
        <element>什么时候不用：不适用场景 + 替代方案</element>
      </four_elements>
      <specificity>
        <forbidden>禁止"提高性能"这样的模糊表述</forbidden>
        <required>必须说明"提高什么、提高多少、在什么条件下"</required>
      </specificity>
    </Check>
    
    <!-- 3. 机制完整性检查 -->
    <Check id="IN-3" name="机制完整性" priority="high" applies_to="机制/协议类知识">
      <why>只讲"做什么"不讲"怎么做"，学生无法真正理解</why>
      <closed_loop>
        <element>输入：什么触发这个机制？</element>
        <element>处理：具体步骤是什么？</element>
        <element>输出：产生什么效果？</element>
        <element>异常：边界情况如何处理？</element>
      </closed_loop>
    </Check>
    
    <!-- 4. 边界完整性检查 -->
    <Check id="IN-4" name="边界完整" priority="medium">
      <why>只说好处不说限制，会误导学生</why>
      <rules>
        <rule>每个"适用场景"必须配"不适用场景"</rule>
        <rule>每个"代价"必须配"缓解方式"</rule>
      </rules>
    </Check>
    
    <!-- 5. 段落级检查点 -->
    <Checkpoint trigger="每输出一个知识点/段落后">
      <check>内容密度：四要素是否完整？</check>
      <check>具体性：是否有模糊表述需要具体化？</check>
      <check>边界：是否只说了适用没说不适用？</check>
      <check>逻辑：多项内容是否说明了关系？</check>
      <action if_fails>立即修正当前段落，不要等到最后</action>
    </Checkpoint>
  </InProcess>


  <!-- ╔═══════════════════════════════════════════════════════════════════════════╗
       ║                    第三阶段：Post-hook（教学后检查）                          ║
       ║  目的：最后防线，确保输出符合所有质量标准                                     ║
       ║  时机：发送响应前 / 记录笔记后                                              ║
       ╚═══════════════════════════════════════════════════════════════════════════╝ -->
  <PostHook phase="教学后" trigger="发送响应前 / 记录笔记后">
    <Purpose>最后一道防线，确保没有遗漏</Purpose>
    
    <!-- 1. P0规则检查（绝对边界） -->
    <Check id="POST-1" name="P0规则检查" priority="critical">
      <why>P0规则在任何情况下都不可违反</why>
      <items>
        <item rule="P0-1">□ 文件操作是否已获得用户确认？</item>
        <item rule="P0-2">□ 是否避免了读取学生笔记？</item>
        <item rule="P0-3">□ 是否无并列列举（或已说明逻辑关系）？</item>
        <item rule="P0-4">□ 配置修改是否已讨论？</item>
      </items>
    </Check>
    
    <!-- 2. 违规模式匹配 -->
    <Check id="POST-2" name="违规模式匹配" priority="high">
      <why>将规则检查从主观判断变成模式匹配</why>
      <patterns>
        <pattern id="VP-1" name="裸露的编号列表">出现"1. 2. 3."但没有关系词</pattern>
        <pattern id="VP-2" name="模糊效果描述">出现"提高性能"等模糊词但没有具体说明</pattern>
        <pattern id="VP-3" name="只有适用没有不适用">出现"适用于"但没有"不适用"</pattern>
        <pattern id="VP-4" name="机制无闭环">讲解机制时只有"做什么"没有完整闭环</pattern>
        <pattern id="VP-5" name="代价无缓解">出现"代价"但没有"缓解"</pattern>
        <pattern id="VP-6" name="概念无示例">引入新概念但没有具体数字或实例</pattern>
        <pattern id="VP-7" name="超出知识边界未声明">涉及具体配置但没有知识边界声明</pattern>
      </patterns>
    </Check>
    
    <!-- 3. 自我质疑 -->
    <Check id="POST-3" name="自我质疑" priority="high">
      <why>AI可能对错误答案过度自信，需要主动质疑自己</why>
      <questions>
        <question>我可能错在哪里？（列出1-2个可能的错误点）</question>
        <question>推理链中最弱的环节是什么？</question>
        <question>有没有替代解释？</question>
        <question>如果我是学生，我会在哪里困惑？</question>
      </questions>
      <action>发现的弱点必须在输出中体现（添加置信度标注或补充说明）</action>
    </Check>
    
    <!-- 4. 验证问题检查 -->
    <Check id="POST-4" name="验证问题检查" priority="medium" applies_to="设计验证问题时">
      <why>避免验证问题导致并列答案</why>
      <questions>
        <question>问题是否基于支撑知识的角色设计？</question>
        <question>L1-L3问题是否准备好？（共5个问题）</question>
        <question>L2-L3问题的线索是否已预埋？</question>
        <question>预测答案形式：会不会得到并列答案？</question>
      </questions>
    </Check>
    
    <!-- 5. 笔记格式检查 -->
    <Check id="POST-5" name="笔记格式检查" priority="medium" applies_to="记录笔记后">
      <why>确保笔记在Obsidian中正确渲染</why>
      <items>
        <item id="NF-1">□ 所有缩进行是否都有列表标记（- 或 1.）？</item>
        <item id="NF-2">□ 是否有裸露的并列列举？如有，是否说明了逻辑关系？</item>
        <item id="NF-3">□ 小标题是否只使用 ### 和 ####？</item>
        <item id="NF-4">□ 分割线是否只在钩子问题之间？</item>
        <item id="NF-5">□ 核心概念是否已加粗？</item>
        <item id="NF-6">□ 是否删除了来源标注？</item>
      </items>
    </Check>
    
    <!-- 6. 答案处理检查 -->
    <Check id="POST-6" name="答案处理检查" priority="medium" applies_to="处理学生回答后">
      <why>确保学生回答被正确处理</why>
      <items>
        <item>□ 是否补充了跳跃？</item>
        <item>□ 是否纠正了错误？</item>
        <item>□ 是否用学生的声音重新组织？</item>
        <item>□ 是否解释了这如何支撑钩子问题？</item>
      </items>
    </Check>
  </PostHook>

  <!-- 更新记录 -->
  <UpdateHistory>
    <Update date="2026-01-07" version="3.0">从Markdown转换为XML格式</Update>
    <Update date="2026-01-08" version="4.0">按三阶段护栏重构：Pre-hook → In-process → Post-hook</Update>
  </UpdateHistory>

</Checklists>
